<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="generator" content="MarkBind 4.1.0">
    <meta name="viewport" content="width=device-width, initial-scale=1"><title>MarkBind - Migrating to TypeScript</title><link rel="stylesheet" href="/markbind/css/bootstrap.min.css">
    <link rel="stylesheet" href="/markbind/fontawesome/css/all.min.css">
    <link rel="stylesheet" href="/markbind/glyphicons/css/bootstrap-glyphicons.min.css">
    <link rel="stylesheet" href="/markbind/css/octicons.css">
    <link rel="stylesheet" href="/markbind/material-icons/material-icons.css">
    <link rel="stylesheet" href="/markbind/css/codeblock-light.min.css"><link rel="stylesheet" href="/markbind/css/markbind.min.css"><script src="/markbind/js/polyfill.min.js"></script>
    <script src="/markbind/js/vue.min.js"></script>
    <script src="/markbind/js/markbind.min.js"></script>
    <script src="migratingToTypeScript.page-vue-render.js"></script>
    <script src="/markbind/js/jquery.min.js"></script><link rel="stylesheet" href="/plugins/markbind-plugin-anchors/markbind-plugin-anchors.css"><link rel="stylesheet" href="/plugins/markbind-plugin-tree/markbind-plugin-tree.css">
    
  <link rel="stylesheet" href="/css/main.css">
<link rel="icon" href="/favicon.ico"></head>
<script>
  const baseUrl = ''
</script>
<body  data-bs-spy="scroll" data-bs-target="#mb-page-nav" data-bs-offset="100" >
<div id="app" data-server-rendered="true"><header sticky=""><div data-v-15113a2f><nav class="navbar navbar-expand-md d-print-none navbar-dark bg-dark" data-v-15113a2f><div class="container-fluid" data-v-15113a2f><div class="navbar-left" data-v-15113a2f><a href="/index.html" title="Home" class="navbar-brand" data-v-15113a2f><img src="/images/logo-darkbackground.svg" height="20" data-v-15113a2f></a></div> <div class="navbar-default" data-v-15113a2f><ul class="navbar-nav me-auto mt-2 mt-lg-0" data-v-15113a2f> <li data-v-15113a2f><a highlight-on="exact" href="/index.html" class="nav-link" data-v-15113a2f>HOME</a></li> <div tags="environment--ug" data-v-15113a2f><li data-v-15113a2f><a highlight-on="sibling-or-child" href="/userGuide/index.html" class="nav-link" data-v-15113a2f>USER GUIDE</a></li></div> <div tags="environment--dg" data-v-15113a2f><li data-v-15113a2f><a highlight-on="sibling-or-child" href="/devGuide/index.html" class="nav-link" data-v-15113a2f>DEVELOPER GUIDE</a></li></div> <li data-v-15113a2f><a highlight-on="exact" href="/showcase.html" class="nav-link" data-v-15113a2f>SHOWCASE</a></li> <li data-v-15113a2f><a highlight-on="exact" href="/about.html" class="nav-link" data-v-15113a2f>ABOUT</a></li> <li data-v-15113a2f><a href="https://github.com/MarkBind/markbind" target="_blank" class="nav-link" data-v-15113a2f><span data-v-15113a2f><span aria-hidden="true" class="fab fa-github" data-v-15113a2f></span></span></a></li></ul></div> <ul class="navbar-nav navbar-right" data-v-15113a2f><li data-v-15113a2f><form class="navbar-form" data-v-15113a2f><div class="dropdown" style="position:relative;" data-v-2955e59c><input data-bs-toggle="dropdown" type="text" placeholder="Search" autocomplete="off" value="" class="form-control" data-v-2955e59c> <div class="form-control placeholder-div-hidden" data-v-2955e59c>
      Search
    </div> <ul class="dropdown-menu search-dropdown-menu d-none dropdown-menu-end" data-v-2955e59c></ul></div></form></li></ul></div></nav> <div class="lower-navbar-container" style="display:none;" data-v-15113a2f><!----> <!----></div></div></header> <div id="flex-body"><nav id="site-nav" data-v-e8c82f88><div class="site-nav-top" data-v-e8c82f88><div class="fw-bold mb-2" style="font-size:1.25rem;" data-v-e8c82f88>Developer Guide</div></div> <div class="nav-component slim-scroll" data-v-e8c82f88><div class="site-nav-root"><ul class="site-nav-list site-nav-list-root" data-v-e8c82f88><li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-0" data-v-e8c82f88><a href="/devGuide/devGuide.html" data-v-e8c82f88>Contributing</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-0" data-v-e8c82f88>Onboarding Bootcamp

<div class="site-nav-dropdown-btn-container" data-v-e8c82f88><i onclick="handleSiteNavClick(this.parentNode.parentNode, false); event.stopPropagation();" class="site-nav-dropdown-btn-icon" data-v-e8c82f88><span aria-hidden="true" class="glyphicon glyphicon-menu-down" data-v-e8c82f88></span></i></div></div><ul class="site-nav-dropdown-container site-nav-list" data-v-e8c82f88><li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-1" data-v-e8c82f88><a href="/devGuide/bootcamp/intro.html" data-v-e8c82f88>Introduction</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-1" data-v-e8c82f88><a href="/devGuide/bootcamp/exploreMarkBind.html" data-v-e8c82f88>Explore MarkBind as a User</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-1" data-v-e8c82f88><a href="/devGuide/bootcamp/contributeToDocs.html" data-v-e8c82f88>Contribute to Documentation</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-1" data-v-e8c82f88><a href="/devGuide/bootcamp/fixABug.html" data-v-e8c82f88>Fix a Bug</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-1" data-v-e8c82f88><a href="/devGuide/bootcamp/implementAFeature.html" data-v-e8c82f88>Implement a New Feature</a></div></li></ul></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-0" data-v-e8c82f88>Development 

<div class="site-nav-dropdown-btn-container" data-v-e8c82f88><i onclick="handleSiteNavClick(this.parentNode.parentNode, false); event.stopPropagation();" class="site-nav-dropdown-btn-icon site-nav-rotate-icon" data-v-e8c82f88><span aria-hidden="true" class="glyphicon glyphicon-menu-down" data-v-e8c82f88></span></i></div></div><ul class="site-nav-dropdown-container site-nav-dropdown-container-open site-nav-list" data-v-e8c82f88><li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-1" data-v-e8c82f88><a href="/devGuide/development/settingUp.html" data-v-e8c82f88>Setting up</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-1" data-v-e8c82f88><a href="/devGuide/development/workflow.html" data-v-e8c82f88>Workflow</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-1" data-v-e8c82f88><a href="/devGuide/development/writingComponents.html" data-v-e8c82f88>Writing Components</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-1" data-v-e8c82f88><a href="/devGuide/development/writingPlugins.html" data-v-e8c82f88>Writing Plugins</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-1" data-v-e8c82f88><a href="/devGuide/development/migratingToTypeScript.html" data-v-e8c82f88>Migrating to TypeScript</a></div></li></ul></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-0" data-v-e8c82f88>Design 

<div class="site-nav-dropdown-btn-container" data-v-e8c82f88><i onclick="handleSiteNavClick(this.parentNode.parentNode, false); event.stopPropagation();" class="site-nav-dropdown-btn-icon site-nav-rotate-icon" data-v-e8c82f88><span aria-hidden="true" class="glyphicon glyphicon-menu-down" data-v-e8c82f88></span></i></div></div><ul class="site-nav-dropdown-container site-nav-dropdown-container-open site-nav-list" data-v-e8c82f88><li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-1" data-v-e8c82f88><a href="/devGuide/design/projectStructure.html" data-v-e8c82f88>Project Structure</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-1" data-v-e8c82f88><a href="/devGuide/design/architecture.html" data-v-e8c82f88>Architecture</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-1" data-v-e8c82f88><a href="/devGuide/design/serverSideRendering.html" data-v-e8c82f88>Server Side Rendering</a></div></li></ul></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-0" data-v-e8c82f88>GitHub Actions

<div class="site-nav-dropdown-btn-container" data-v-e8c82f88><i onclick="handleSiteNavClick(this.parentNode.parentNode, false); event.stopPropagation();" class="site-nav-dropdown-btn-icon" data-v-e8c82f88><span aria-hidden="true" class="glyphicon glyphicon-menu-down" data-v-e8c82f88></span></i></div></div><ul class="site-nav-dropdown-container site-nav-list" data-v-e8c82f88><li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-1" data-v-e8c82f88><a href="/devGuide/githubActions/overview.html" data-v-e8c82f88>Overview</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-1" data-v-e8c82f88><a href="/devGuide/githubActions/markbindAction.html" data-v-e8c82f88>markbind-action</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-1" data-v-e8c82f88><a href="/devGuide/githubActions/markbindReusableWorkflows.html" data-v-e8c82f88>markbind-reusable-workflows</a></div></li></ul></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-0" data-v-e8c82f88><a href="/devGuide/projectManagement.html" data-v-e8c82f88>Project management</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-0" data-v-e8c82f88>Appendices 

<div class="site-nav-dropdown-btn-container" data-v-e8c82f88><i onclick="handleSiteNavClick(this.parentNode.parentNode, false); event.stopPropagation();" class="site-nav-dropdown-btn-icon site-nav-rotate-icon" data-v-e8c82f88><span aria-hidden="true" class="glyphicon glyphicon-menu-down" data-v-e8c82f88></span></i></div></div><ul class="site-nav-dropdown-container site-nav-dropdown-container-open site-nav-list" data-v-e8c82f88><li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-1" data-v-e8c82f88><a href="/devGuide/styleGuides.html" data-v-e8c82f88>Style guides</a></div></li></ul></li> <!----></ul></div></div> <!----></nav> <div id="content-wrapper"><p><span id="title" class="d-none">Migrating to TypeScript</span></p> <h1 id="migrating-to-typescript"><span id="migrating-to-typescript" class="anchor"></span>Migrating to TypeScript<a href="#migrating-to-typescript" onclick="event.stopPropagation()" class="fa fa-anchor"></a></h1> <div class="lead"><p>In order to improve the quality and security of our backend code, we are introducing TypeScript to our codebase to leverage the type-checking system. This page outlines the steps of migrating existing files into TypeScript.</p></div> <h2 id="migration-steps"><span id="migration-steps" class="anchor"></span>Migration Steps<a href="#migration-steps" onclick="event.stopPropagation()" class="fa fa-anchor"></a></h2> <p>The TypeScript migration process is a little different than normal development work, as maintainers would not follow the normal procedure of creating a squash commit. Instead, they will do a <strong>rebase and merge</strong>, and therefore migration developers will need to structure the commits in a particular way.</p> <p>We have decided on structuring the commits as two commits: a &quot;Rename&quot; commit and an &quot;Adapt&quot; commit. If you need further context on the approach, feel free to read the <a href="#explanation-notes">Explanation Notes</a> section below.</p> <h3 id="step-1-preparation"><span id="step-1-preparation" class="anchor"></span>Step 1: Preparation<a href="#step-1-preparation" onclick="event.stopPropagation()" class="fa fa-anchor"></a></h3> <ol><li><p><strong>If running, stop automatic compilation on change/save</strong>. More on this at <a href="/devGuide/development/workflow.html#editing-backend-features">Editing backend features</a> section in the Workflow page.</p></li> <li><p><strong>Install typings of external dependencies</strong> relevant to the files, if there's any that hasn't been installed yet.</p> <p>Generally, external modules have their typings published as another module named <code class="hljs inline no-lang">@types/&lt;lib-name&gt;</code> (e.g. <code class="hljs inline no-lang">@types/jest</code>) or bundled alongside their implementation. You can check which is the case <a href="https://www.typescriptlang.org/dt/search?search=">here</a>. Check for <code class="hljs inline no-lang">@types/&lt;lib-name&gt;</code> first, then check for <code class="hljs inline no-lang">&lt;lib-name&gt;</code> itself if not found.</p> <p>If the dependency has its typings:</p> <ul><li><p>Bundled alongside their implementation, you don't need to do anything else.</p></li> <li><p>In a <code class="hljs inline no-lang">@types/&lt;lib-name&gt;</code> module, install it as a development dependency for the <code class="hljs inline no-lang">core</code> package by navigating to <code class="hljs inline no-lang">packages/core</code> and running <code class="hljs inline no-lang">npm i -D @types/&lt;lib-name&gt;</code>.</p> <p>After installing all necessary typings, delete the generated <code class="hljs inline no-lang">packages/core/package-lock.json</code>, navigate back to the root directory, and run <code class="hljs inline no-lang">npm run setup</code>.</p> <div class="alert box-container alert-info" data-v-b8113688><!----> <div class="header-and-body" data-v-b8113688><!----> <div class="box-body-wrapper" data-v-b8113688><div class="icon-wrapper" data-v-b8113688><i class="fas fa-info" data-v-b8113688></i></div> <!----> <div class="contents" data-v-b8113688><p data-v-b8113688>It's recommended to try to match the <code class="hljs inline no-lang" data-v-b8113688>@types/&lt;lib-name&gt;</code> version with the associated module. In general, try to match the major and minor version as closely as possible.</p></div> <!----></div></div></div></li></ul></li> <li><p><strong>Stash the changes</strong> (<code class="hljs inline no-lang">packages/core/package.json</code> and root <code class="hljs inline no-lang">package-lock.json</code>).
<br>
This will be added back during the &quot;Adapt&quot; commit later.</p></li></ol> <h3 id="step-2-and-quot-rename-and-quot-commit"><span id="step-2-and-quot-rename-and-quot-commit" class="anchor"></span>Step 2: &quot;Rename&quot; Commit<a href="#step-2-and-quot-rename-and-quot-commit" onclick="event.stopPropagation()" class="fa fa-anchor"></a></h3> <ol><li><p><strong>Add the paths of the <code class="hljs inline no-lang">.js</code> files to <code class="hljs inline no-lang">.gitignore</code> and <code class="hljs inline no-lang">.eslintignore</code></strong>.
<br>
This instructs Git and ESLint to ignore the compiled JavaScript from the files that are going to be renamed.</p></li> <li><p><strong>Rename the files</strong> from having <code class="hljs inline no-lang">.js</code> extensions to <code class="hljs inline no-lang">.ts</code> extensions.</p></li> <li><p><strong>Stage the changes</strong> (the renamed files, <code class="hljs inline no-lang">.gitignore</code>, and <code class="hljs inline no-lang">.eslintignore</code>) for commit.
<br>
Ensure the renamed files are regarded by Git as <code class="hljs inline no-lang">renamed</code> and not <code class="hljs inline no-lang">added</code>.</p></li> <li><p><strong>Commit the staged changes</strong> with the message <code class="hljs inline no-lang">Rename &lt;file-or-folder&gt; to TypeScript</code>.
<br>
For example: <code class="hljs inline no-lang">Rename core/src/html to TypeScript</code>.</p> <div class="alert box-container alert-info" data-v-b8113688><!----> <div class="header-and-body" data-v-b8113688><!----> <div class="box-body-wrapper" data-v-b8113688><div class="icon-wrapper" data-v-b8113688><i class="fas fa-info" data-v-b8113688></i></div> <!----> <div class="contents" data-v-b8113688><p data-v-b8113688>Any of the <a href="/devGuide/development/workflow.html#git-hooks" data-v-b8113688>MarkBind-specific git hooks</a> that have been installed during the <a href="/devGuide/development/settingUp.html#setting-up-the-git-hooks-optional-but-recommended" data-v-b8113688>setup process</a> will automatically build the backend. If you encounter any compilation errors while committing and/or pushing the &quot;Rename&quot; commit due to git hooks, skip the hooks using the <code class="hljs inline no-lang" data-v-b8113688>--no-verify</code> flag.
For example: <code class="hljs inline no-lang" data-v-b8113688>git commit --no-verify -m &quot;Rename core/src/html to TypeScript&quot;</code>.</p></div> <!----></div></div></div></li></ol> <h3 id="step-3-and-quot-adapt-and-quot-commit"><span id="step-3-and-quot-adapt-and-quot-commit" class="anchor"></span>Step 3: &quot;Adapt&quot; Commit<a href="#step-3-and-quot-adapt-and-quot-commit" onclick="event.stopPropagation()" class="fa fa-anchor"></a></h3> <ol><li><p><strong>Start automatic compilation on change/save</strong>. More on this at <a href="/devGuide/development/workflow.html#editing-backend-features">Editing backend features</a> section in the Workflow page.</p></li> <li><p><strong>Change the CommonJS module import/export syntax</strong> to TypeScript's equivalent syntax (use ES6 syntax only if possible).</p> <p>A common error in newly renamed files comes from the way modules are imported/exported. Those statements can be converted according to the <a href="#import-export-syntax-reference">Import/Export Syntax Reference</a> section below. The steps are as follows:</p> <ol><li><p>Start by changing the import/export statements into TypeScript equivalent syntax. Be careful with imports as you have to match them with the export syntax that the modules use, be it TypeScript equivalent or ES6.</p></li> <li><p>Check whether it is possible to change the export to use ES6 syntax. As mentioned in the syntax reference, ES6 should not be used if the module only exports a single thing. Change to ES6 syntax only if possible, otherwise keep with TypeScript equivalent syntax.</p></li> <li><p>You might have to <strong>adjust how the files are imported by other TypeScript (<code class="hljs inline no-lang">.ts</code>) files</strong>. If you are changing the export to the TypeScript equivalent syntax, then it must be imported the same way as well. The same goes for the ES6 syntax.</p></li></ol></li> <li><p><strong>Adapt the files</strong> fully to TypeScript.</p> <p>The errors from TypeScript and <code class="hljs inline no-lang">typescript-eslint</code> can guide you on what to fix. Only fix what is necessary and be careful with accidentally modifying any code functionality. Avoid using <code class="hljs inline no-lang">any</code> as best as you can.</p> <p>If you happen to encounter type errors related to using names (of constant, properties, members, etc.) from another MarkBind import that is still in JavaScript (<code class="hljs inline no-lang">.js</code>), you can try to infer simple types in your file first as a &quot;stand-in&quot; of the more robust types when that internal dependency is eventually migrated.</p> <p>On the flip side of the above situation, once you have developed a robust type for your own file, <strong>adjust how other TypeScript (<code class="hljs inline no-lang">.ts</code>) files type names referenced from your files</strong> as applicable. Some type declarations might need to be made stricter, or can be removed if it's not necessary anymore, and so on. This will ensure that the files will be incrementally stricter.</p></li> <li><p><strong>Make sure everything is in order</strong> by running <code class="hljs inline no-lang">npm run test</code> in the root directory.</p> <p>The <code class="hljs inline no-lang">core</code> package tests can directly run on the <code class="hljs inline no-lang">.ts</code> files (powered by <code class="hljs inline no-lang">ts-jest</code>), and the <code class="hljs inline no-lang">cli</code> package tests uses the compiled files from <code class="hljs inline no-lang">core</code>. Therefore, passing the <code class="hljs inline no-lang">cli</code> tests means that it is very likely the compiled files work as expected.</p></li> <li><p><strong>Stage the adapted files and the typings from Step 1</strong> for commit. Verify the changes before committing.</p></li> <li><p><strong>Commit the changes</strong> with the message <code class="hljs inline no-lang">Adapt &lt;file-or-folder&gt; to TypeScript</code>.
<br>
For example, <code class="hljs inline no-lang">Adapt core/src/html to TypeScript</code>.</p></li></ol> <p>You are now ready to create a pull request for the changes to the repository.</p> <h3 id="optional-step-4-changing-the-commit"><span id="optional-step-4-changing-the-commit" class="anchor"></span>(Optional) Step 4: Changing the commit<a href="#optional-step-4-changing-the-commit" onclick="event.stopPropagation()" class="fa fa-anchor"></a></h3> <p>While refactoring you may encounter scenarios where you might have to amend your code after a commit. There are 2 common scenarios which we will cover.</p> <div class="card-container" data-v-5681bde8><!----> <div class="card expandable-card" data-v-5681bde8><div class="card-header header-toggle bg-light" data-v-5681bde8><div class="caret-wrapper" data-v-5681bde8><!----></div> <div class="header-wrapper card-title bg-light" data-v-5681bde8><p data-v-5681bde8>Scenario 1: You have 2 commits and want to add on to the second commit.</p></div> <div class="button-wrapper" data-v-5681bde8><button type="button" class="collapse-button btn btn-outline-secondary" data-v-5681bde8><span aria-hidden="true" class="collapse-icon glyphicon glyphicon-menu-down"></span></button> <button type="button" class="close-button btn btn-outline-secondary" data-v-5681bde8><span aria-hidden="true" class="glyphicon glyphicon-remove" data-v-5681bde8></span></button> <button type="button" class="popup-button btn btn-outline-secondary" style="display:none;" data-v-5681bde8><span aria-hidden="true" class="glyphicon glyphicon-new-window" data-v-5681bde8></span></button></div></div> <div class="card-collapse" data-v-5681bde8><!----> <hr style="display:none;" data-v-5681bde8></div> <!----></div></div> <div class="card-container" data-v-5681bde8><!----> <div class="card expandable-card" data-v-5681bde8><div class="card-header header-toggle bg-light" data-v-5681bde8><div class="caret-wrapper" data-v-5681bde8><!----></div> <div class="header-wrapper card-title bg-light" data-v-5681bde8><p data-v-5681bde8>Scenario 2: You have more than 2 commits and want to make it into 2 commits.</p></div> <div class="button-wrapper" data-v-5681bde8><button type="button" class="collapse-button btn btn-outline-secondary" data-v-5681bde8><span aria-hidden="true" class="collapse-icon glyphicon glyphicon-menu-down"></span></button> <button type="button" class="close-button btn btn-outline-secondary" data-v-5681bde8><span aria-hidden="true" class="glyphicon glyphicon-remove" data-v-5681bde8></span></button> <button type="button" class="popup-button btn btn-outline-secondary" style="display:none;" data-v-5681bde8><span aria-hidden="true" class="glyphicon glyphicon-new-window" data-v-5681bde8></span></button></div></div> <div class="card-collapse" data-v-5681bde8><!----> <hr style="display:none;" data-v-5681bde8></div> <!----></div></div> <br> <h2 id="example-of-migrated-works"><span id="example-of-migrated-works" class="anchor"></span>Example of Migrated Works<a href="#example-of-migrated-works" onclick="event.stopPropagation()" class="fa fa-anchor"></a></h2> <p>You can see these pull requests to observe the finished migration works:</p> <ul><li><a href="https://github.com/MarkBind/markbind/pull/1877">#1877: Adopt TypeScript for core package</a></li></ul> <h2 id="import-export-syntax-reference"><span id="import-export-syntax-reference" class="anchor"></span>Import/Export Syntax Reference<a href="#import-export-syntax-reference" onclick="event.stopPropagation()" class="fa fa-anchor"></a></h2> <p>Here is the reference on changing the import/export statements from CommonJS syntax into those that TypeScript support: TypeScript equivalent syntax, and ES6 syntax.</p> <p>The TypeScript equivalent syntax is designed to compile to the exact same code as CommonJS. You can read more about this syntax in the <a href="https://www.typescriptlang.org/docs/handbook/modules.html#export--and-import--require">official documentation</a>.</p> <p>The ES6 syntax is the newer JavaScript syntax that TypeScript recommends, but in certain cases it does not compile to the exact same code as CommonJS. We simplify the concepts here for illustration, refer to the StackOverflow post <a href="https://stackoverflow.com/questions/40294870/module-exports-vs-export-default-in-node-js-and-es6">here</a> for more details.</p> <p>In the tables below, a &quot;thing&quot; is defined as a JavaScript construct that can be exported, such as constants, functions, classes, etc. In ES6 syntax, a &quot;thing&quot; can also be TypeScript constructs like types, interfaces, enums, etc.</p> <p><span class="underline"><strong>Exports</strong></span></p> <div class="table-responsive"><table class="markbind-table table table-bordered table-striped"><thead><tr><th>What to Export</th> <th>CommonJS</th> <th>TypeScript equivalent</th> <th>ES6</th></tr></thead> <tbody><tr><td>One thing only</td> <td><code class="hljs inline no-lang">module.exports = x</code></td> <td><code class="hljs inline no-lang">export = x</code></td> <td><code class="hljs inline no-lang">export default x</code> <strong> ^</strong></td></tr> <tr><td>Object of one/more things</td> <td><code class="hljs inline no-lang">module.exports = { x, y, z }</code></td> <td><code class="hljs inline no-lang">export = { x, y, z }</code></td> <td><code class="hljs inline no-lang">export { x, y, z }</code></td></tr></tbody></table></div><p><strong>^</strong>: For compatibility, <strong>do not use</strong> <code class="hljs inline no-lang">export default</code> during migration. It is compiled differently and does not play well with dependants that are still in <code class="hljs inline no-lang">.js</code>, unless some clunky modifications are made in the <code class="hljs inline no-lang">.js</code> files (refer to the StackOverflow post previously <a href="https://stackoverflow.com/questions/40294870/module-exports-vs-export-default-in-node-js-and-es6">linked</a>).</p> <p><span class="underline"><strong>Imports from a module that exports one thing only</strong></span></p> <div class="table-responsive"><table class="markbind-table table table-bordered table-striped"><thead><tr><th>What to Import</th> <th>CommonJS</th> <th>TypeScript equivalent</th> <th>ES6</th></tr></thead> <tbody><tr><td>Exported thing</td> <td><code class="hljs inline no-lang">const x = require(a)</code></td> <td><code class="hljs inline no-lang">import x = require(a)</code> <strong> ^</strong></td> <td><code class="hljs inline no-lang">import x from a</code> <strong> ^</strong></td></tr></tbody></table></div><p><strong>^</strong>: You can only use TypeScript equivalent syntax when the exported module is also in the TypeScript equivalent syntax. The same goes for the ES6 syntax.</p> <p><span class="underline"><strong>Imports from a module that exports an object of one/more things</strong></span></p> <div class="table-responsive"><table class="markbind-table table table-bordered table-striped"><thead><tr><th>What to Import</th> <th>CommonJS</th> <th>TypeScript equivalent</th> <th>ES6</th></tr></thead> <tbody><tr><td>Entire object</td> <td><code class="hljs inline no-lang">const w = require(a)</code></td> <td><code class="hljs inline no-lang">import w = require(a)</code></td> <td><code class="hljs inline no-lang">import * as w from a</code></td></tr> <tr><td>Selected things</td> <td><code class="hljs inline no-lang">const { x } = require(a)</code></td> <td>N/A  <strong> ^</strong></td> <td><code class="hljs inline no-lang">import { x } from a</code></td></tr></tbody></table></div><p><strong>^</strong>: While not equivalent on the compile-level, this can be achieved by importing the entire object then destructuring the object.</p> <h2 id="explanation-notes"><span id="explanation-notes" class="anchor"></span>Explanation Notes<a href="#explanation-notes" onclick="event.stopPropagation()" class="fa fa-anchor"></a></h2> <h3 id="why-do-we-need-to-separate-and-quot-rename-and-quot-and-and-quot-adapt-and-quot-commits"><span id="why-do-we-need-to-separate-and-quot-rename-and-quot-and-and-quot-adapt-and-quot-commits" class="anchor"></span>Why do we need to separate &quot;Rename&quot; and &quot;Adapt&quot; commits<a href="#why-do-we-need-to-separate-and-quot-rename-and-quot-and-and-quot-adapt-and-quot-commits" onclick="event.stopPropagation()" class="fa fa-anchor"></a></h3> <p>We want to keep the file history intact throughout this migration, meaning that we should still be able to see the change history of the <code class="hljs inline no-lang">.ts</code> files even from the time when they were still in <code class="hljs inline no-lang">.js</code>.</p> <p>When we rename files, we have to keep the Git similarity index between the old file and the new file above a certain threshold (50%) to keep the history, or else it will be regarded as a different file with its own history.</p> <p>Combining the two steps into one - that is, adapting files immediately after renaming - will lower the similarity index, therefore making it possible for the files, especially small ones or those that need a lot of changes when adapting, to hit below the similarity threshold and lose their history.</p> <p>The solution to this is to make the rename and adapt commits separate, in order for Git to recognize first that the file has changed into <code class="hljs inline no-lang">.ts</code>, and so the changes are compared not against the old <code class="hljs inline no-lang">.js</code> file, but to the renamed <code class="hljs inline no-lang">.ts</code> file instead.</p> <h3 id="why-do-we-need-a-rebase-and-merge-commit"><span id="why-do-we-need-a-rebase-and-merge-commit" class="anchor"></span>Why do we need a rebase and merge commit<a href="#why-do-we-need-a-rebase-and-merge-commit" onclick="event.stopPropagation()" class="fa fa-anchor"></a></h3> <p>Even if the migration developer has kept the history intact through the separate &quot;Rename&quot; and &quot;Adapt&quot; commits, this is only intact at their working branch. At the end of the day, the totality of the changes in the working branch is compared against the target branch, in which the same consideration would apply.</p> <p>If we do the usual squash commit, the changes from the two commits are combined into a new commit and only that commit will be pushed into the target branch. The original two commits are omitted, therefore the history of the working branch that we have tried to keep intact is stripped away. This results in a linear history, as if the changes in the working branch were made
after the latest changes in the target branch.</p> <div class="clearfix"><p><span class="float-start"><a href="/devGuide/development/writingPlugins.html" class="btn btn-light"><span><span aria-hidden="true" class="far fa-arrow-alt-circle-left"></span> <span>Writing Plugins</span></span></a></span></p> <p><span class="float-end"><a href="/devGuide/design/projectStructure.html" class="btn btn-light"><span><span>Project Structure</span> <span aria-hidden="true" class="far fa-arrow-alt-circle-right"></span></span></a></span></p></div> <br></div> <nav id="page-nav" data-v-e8c82f88><div class="nav-component slim-scroll" data-v-e8c82f88><nav id="mb-page-nav" class="nav nav-pills flex-column my-0 small no-flex-wrap" data-v-e8c82f88><a class="nav-link py-1" href="#migrating-to-typescript" data-v-e8c82f88>Migrating to TypeScript‎</a> <nav class="nav nav-pills flex-column my-0 nested no-flex-wrap" data-v-e8c82f88><a class="nav-link py-1" href="#migration-steps" data-v-e8c82f88>Migration Steps‎</a> <nav class="nav nav-pills flex-column my-0 nested no-flex-wrap" data-v-e8c82f88><a class="nav-link py-1" href="#step-1-preparation" data-v-e8c82f88>Step 1: Preparation‎</a> <a class="nav-link py-1" href="#step-2-and-quot-rename-and-quot-commit" data-v-e8c82f88>Step 2: &quot;Rename&quot; Commit‎</a> <a class="nav-link py-1" href="#step-3-and-quot-adapt-and-quot-commit" data-v-e8c82f88>Step 3: &quot;Adapt&quot; Commit‎</a> <a class="nav-link py-1" href="#optional-step-4-changing-the-commit" data-v-e8c82f88>(Optional) Step 4: Changing the commit‎</a></nav> <a class="nav-link py-1" href="#example-of-migrated-works" data-v-e8c82f88>Example of Migrated Works‎</a> <a class="nav-link py-1" href="#import-export-syntax-reference" data-v-e8c82f88>Import/Export Syntax Reference‎</a> <a class="nav-link py-1" href="#explanation-notes" data-v-e8c82f88>Explanation Notes‎</a> <nav class="nav nav-pills flex-column my-0 nested no-flex-wrap" data-v-e8c82f88><a class="nav-link py-1" href="#why-do-we-need-to-separate-and-quot-rename-and-quot-and-and-quot-adapt-and-quot-commits" data-v-e8c82f88>Why do we need to separate &quot;Rename&quot; and &quot;Adapt&quot; commits‎</a> <a class="nav-link py-1" href="#why-do-we-need-a-rebase-and-merge-commit" data-v-e8c82f88>Why do we need a rebase and merge commit‎</a></nav></nav> <!----></nav></div> <!----></nav> <scroll-top-button></scroll-top-button></div> <div><footer><div class="text-center"><small>[Generated by <a href="https://markbind.org/">MarkBind 4.1.0</a> on Fri, 24 Mar 2023, 15:27:12 GMT+8]</small><br> <small>This site is powered by <a href="https://www.netlify.com/">Netlify</a>.</small></div></footer></div></div>
</body><script src="/markbind/js/bootstrap-utility.min.js"></script>
<script>
  MarkBind.setupWithSearch()
</script>
    <script>
    function toggleCodeBlockWrap(element) {
      const pre = element.parentElement.parentElement;
      const codeElement = $(pre.querySelector('code'));

      codeElement.toggleClass('wrap');
    }
    </script>
</html>
